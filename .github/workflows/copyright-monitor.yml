# Copyright Monitoring Workflow
# Runs weekly to check for potential site copies
# Sends notification if suspicious activity detected

name: Copyright Monitor

on:
  schedule:
    # Run every Monday at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch: # Allow manual trigger

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10.28.2
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Run copyright monitor
        run: pnpm exec ts-node scripts/monitor-copycats.ts
        continue-on-error: true
      
      - name: Check for watermarks in search results
        run: |
          echo "Checking Google for unauthorized copies..."
          echo ""
          echo "Manual verification required for:"
          echo "1. Search: \"Elevate for Humanity\" -site:elevateforhumanity.org"
          echo "2. Search: \"EFH-ORIGINAL-2024\""
          echo ""
          echo "If results found, follow docs/COPYRIGHT-PROTECTION.md"
      
      # Optional: Send Slack notification
      # - name: Notify Slack
      #   if: failure()
      #   uses: 8398a7/action-slack@v3
      #   with:
      #     status: ${{ job.status }}
      #     text: 'Copyright monitoring detected potential issues'
      #   env:
      #     SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
      
      # Optional: Create issue if problems found
      # - name: Create Issue
      #   if: failure()
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       github.rest.issues.create({
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         title: 'Copyright Alert: Potential infringement detected',
      #         body: 'The weekly copyright monitor found potential issues. Please review.',
      #         labels: ['legal', 'urgent']
      #       })
