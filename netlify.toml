# Netlify Configuration - Elevate for Humanity
# Canonical domain: www.elevateforhumanity.org (with www)
# Admin domain: elevateconnectsdirectory.org (separate admin panel)

[build]
  command = "pnpm run build"
  publish = ".next"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "20"
  NETLIFY_USE_PNPM = "true"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# =============================================================================
# SCHEDULED FUNCTIONS (Social Media Automation)
# =============================================================================

[functions]
  node_bundler = "esbuild"


# Social Media Scheduler - Runs 3x daily (9 AM, 1 PM, 5 PM EST)
# Cron: 0 14,18,22 * * * (UTC times for EST schedule)
[functions."social-media-scheduler"]
  schedule = "0 14,18,22 * * *"

# ============================================
# LMS DOMAIN (elevateforhumanityeducation.com)
# Do NOT redirect - handled by middleware -> /student-portal
# ============================================

# ============================================
# SUPERSONIC DOMAIN (supersonicfastermoney.com)
# Do NOT redirect - handled by middleware -> /supersonic-fast-cash
# ============================================

# ============================================
# CANONICAL DOMAIN REDIRECTS (301 = permanent)
# All traffic funnels to www.elevateforhumanity.org
# ============================================

# Naked org -> www org (canonical)
[[redirects]]
  from = "https://elevateforhumanity.org/*"
  to = "https://www.elevateforhumanity.org/:splat"
  status = 301
  force = true

# HTTP -> HTTPS
[[redirects]]
  from = "http://elevateforhumanity.org/*"
  to = "https://www.elevateforhumanity.org/:splat"
  status = 301
  force = true

[[redirects]]
  from = "http://www.elevateforhumanity.org/*"
  to = "https://www.elevateforhumanity.org/:splat"
  status = 301
  force = true

# ============================================
# ROUTE REDIRECTS
# ============================================

[[redirects]]
  from = "/student/dashboard"
  to = "/student-portal"
  status = 308
  force = true

[[redirects]]
  from = "/student/dashboard/*"
  to = "/student-portal"
  status = 308
  force = true

[[redirects]]
  from = "/student"
  to = "/student-portal"
  status = 308
  force = true

[[redirects]]
  from = "/partner-with-us"
  to = "/partner"
  status = 308
  force = true

[[redirects]]
  from = "/program-holder/apply"
  to = "/apply"
  status = 308
  force = true

[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301

[[redirects]]
  from = "/home"
  to = "/"
  status = 301

# ============================================
# HEADERS
# ============================================

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "origin-when-cross-origin"

[[headers]]
  for = "/_next/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/api/*"
  [headers.values]
    Cache-Control = "no-store"
